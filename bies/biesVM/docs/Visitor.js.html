<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: Visitor.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: Visitor.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import chalk from 'chalk';
import biesLanguageVisitor from '../output/biesLanguageVisitor.js';
import VM from './Vm.js';

/**
 * Clase que implementa un visitante para el lenguaje Bies.
 * Extiende la funcionalidad de `biesLanguageVisitor` para recorrer un árbol de sintaxis y
 * generar las instrucciones correspondientes que se ejecutarán en la máquina virtual (VM).
 */
export class Visitor extends biesLanguageVisitor {
    /**
     * Crea una instancia de la clase Visitor.
     * @param {Object} [logger={ log: () => {} }] - Objeto que define el comportamiento del logger. Por defecto, usa un logger vacío.
     */
    constructor(logger = { log: () => {} }) {
        super();
        /**
         * Máquina virtual utilizada para ejecutar las instrucciones generadas.
         * @type {VM}
         */
        this.vm = new VM(logger);

        /**
         * Logger para registrar las operaciones del visitante.
         * @type {Object}
         */
        this.logger = logger;

        /**
         * Código acumulado durante el recorrido del árbol de sintaxis.
         * @type {Array&lt;{ type: string, args: string[] }>}
         */
        this.code = [];
    }

    /**
     * Visita el nodo raíz del programa y recorre todos sus elementos.
     * Al finalizar el recorrido, envía el código acumulado para su ejecución en la máquina virtual.
     * @param {Object} ctx - Contexto del nodo del programa en el árbol de sintaxis.
     * @returns {VM} Instancia de la máquina virtual (`VM`) con las funciones y código cargado.
     */
    visitProgram(ctx) {
        this.logger.log(chalk.cyanBright('Visitando el programa'));
        super.visitProgram(ctx); // Visita cada elemento del programa y acumula las instrucciones
        this.sendCode(); // Envía el código para que sea ejecutado en `run()`
        return this.vm;
    }

    /**
     * Visita la definición de una función en el programa.
     * Almacena el nombre de la función y su cuerpo en la máquina virtual (`VM`).
     * @param {Object} ctx - Contexto del nodo de la definición de la función en el árbol de sintaxis.
     * @returns {*} El resultado de la visita a la definición de la función.
     */
    visitFunctionDef(ctx) {
        const functionName = ctx.LABEL_IDENTIFIER(0).getText();
        const functionBody = ctx.statement().map(stmt => stmt.getText());

        if (!this.vm.functions) {
            this.vm.functions = {};
        }

        this.vm.functions[functionName] = functionBody;
        this.logger.log(chalk.blue(`Definida función ${functionName} con cuerpo: ${functionBody}`));

        return super.visitFunctionDef(ctx);
    }

    /**
     * Visita una instrucción en el programa.
     * Divide la instrucción en sus partes (`type` y `args`) y la acumula en el arreglo `this.code`.
     * @param {Object} ctx - Contexto del nodo de la instrucción en el árbol de sintaxis.
     * @returns {*} El resultado de la visita a la instrucción.
     */
    visitInstruction(ctx) {
        const text = ctx.getText().trim();

        const parts = text.split(/\s+/);
        const type = parts[0];
        const args = parts.slice(1);

        this.code.push({ type, args });

        return super.visitInstruction(ctx);
    }

    /**
     * Envía el código acumulado a la máquina virtual (`VM`) para su ejecución.
     * Llama a la función `run` de la máquina virtual con el arreglo de instrucciones `this.code`.
     */
    sendCode() {
        this.vm.run(this.code); // Ejecuta todas las instrucciones almacenadas en `this.code`
    }
}

export default Visitor;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-biesVM.html">biesVM</a></li></ul><h3>Classes</h3><ul><li><a href="Logger.html">Logger</a></li><li><a href="VM.html">VM</a></li><li><a href="Visitor.html">Visitor</a></li></ul><h3>Global</h3><ul><li><a href="global.html#analizarArchivoBasm">analizarArchivoBasm</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.3</a> on Fri Oct 25 2024 19:42:06 GMT-0600 (hora estándar central)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
